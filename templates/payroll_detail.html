{% extends "base.html" %}

{% block content %}
<div class="table-container">
    <h2 style="margin-bottom: 20px;">üìã Fiche de Paie</h2>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
        <!-- Informations Employ√© -->
        <div style="padding: 15px; background: #f5f5f5; border-radius: 6px;">
            <h3 style="margin-top: 0;">üë§ Employ√©</h3>
            <p><strong>Nom :</strong> {{ payroll.employee.user.get_full_name }}</p>
            <p><strong>ID Employ√© :</strong> {{ payroll.employee.employee_id }}</p>
            <p><strong>Profession :</strong> {{ payroll.employee.profession.label }}</p>
        </div>
        
        <!-- P√©riode -->
        <div style="padding: 15px; background: #f5f5f5; border-radius: 6px;">
            <h3 style="margin-top: 0;">üìÖ P√©riode</h3>
            <p><strong>Mois :</strong> {{ payroll.month|stringformat:"02d" }}/{{ payroll.year }}</p>
            <p><strong>Statut :</strong> 
                {% if payroll.status == 'draft' %}
                    <span class="badge badge-info">Brouillon</span>
                {% elif payroll.status == 'calculated' %}
                    <span class="badge badge-warning">Calcul√©</span>
                {% elif payroll.status == 'validated' %}
                    <span class="badge badge-success">Valid√©</span>
                {% else %}
                    <span class="badge">{{ payroll.get_status_display }}</span>
                {% endif %}
            </p>
        </div>
    </div>
    
    <!-- Heures travaill√©es -->
    <h3>‚è±Ô∏è Heures Travaill√©es</h3>
    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; margin-bottom: 20px;">
        <div style="padding: 15px; background: #e8f5e9; border-radius: 6px;">
            <p style="margin: 0; color: #666; font-size: 0.9em;">Heures Normales</p>
            <p style="margin: 5px 0 0 0; font-size: 1.8em; font-weight: bold;">{{ payroll.normal_hours|floatformat:2 }} h</p>
        </div>
        <div style="padding: 15px; background: #f3e5f5; border-radius: 6px;">
            <p style="margin: 0; color: #666; font-size: 0.9em;">Heures de Nuit</p>
            <p style="margin: 5px 0 0 0; font-size: 1.8em; font-weight: bold;">{{ payroll.night_hours|floatformat:2 }} h</p>
        </div>
        <div style="padding: 15px; background: #fff3e0; border-radius: 6px;">
            <p style="margin: 0; color: #666; font-size: 0.9em;">Heures Dimanche</p>
            <p style="margin: 5px 0 0 0; font-size: 1.8em; font-weight: bold;">{{ payroll.sunday_hours|floatformat:2 }} h</p>
        </div>
        <div style="padding: 15px; background: #ffebee; border-radius: 6px;">
            <p style="margin: 0; color: #666; font-size: 0.9em;">Heures F√©ries</p>
            <p style="margin: 5px 0 0 0; font-size: 1.8em; font-weight: bold;">{{ payroll.holiday_hours|floatformat:2 }} h</p>
        </div>
        <div style="padding: 15px; background: #e1f5fe; border-radius: 6px;">
            <p style="margin: 0; color: #666; font-size: 0.9em;">Heures Suppl√©mentaires</p>
            <p style="margin: 5px 0 0 0; font-size: 1.8em; font-weight: bold;">{{ payroll.overtime_hours|floatformat:2 }} h</p>
        </div>
    </div>
    
    <!-- Salaires -->
    <h3>üíµ Salaires</h3>
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
        <div style="padding: 15px; background: #e3f2fd; border-radius: 6px;">
            <p style="margin: 0; color: #666; font-size: 0.9em;">Salaire Brut</p>
            <p style="margin: 5px 0 0 0; font-size: 1.8em; font-weight: bold;">{{ payroll.gross_salary|floatformat:2 }} ‚Ç¨</p>
        </div>
        <div style="padding: 15px; background: #fce4ec; border-radius: 6px;">
            <p style="margin: 0; color: #666; font-size: 0.9em;">D√©ductions</p>
            <p style="margin: 5px 0 0 0; font-size: 1.8em; font-weight: bold;">{{ payroll.total_deductions|floatformat:2 }} ‚Ç¨</p>
        </div>
    </div>
    
    <!-- D√©tails des Cotisations Sociales -->
    {% if contribution_details %}
    <h3>üèõÔ∏è D√©tail des Cotisations Sociales</h3>
    <div style="overflow-x: auto; margin-bottom: 20px;">
        <table style="width: 100%; border-collapse: collapse; background: white;">
            <thead>
                <tr style="background: #f5f5f5; border-bottom: 2px solid #ddd;">
                    <th style="padding: 12px; text-align: left; border: 1px solid #eee;">Cotisation</th>
                    <th style="padding: 12px; text-align: center; border: 1px solid #eee;">Taux</th>
                    <th style="padding: 12px; text-align: center; border: 1px solid #eee;">Assiette (‚Ç¨)</th>
                    <th style="padding: 12px; text-align: center; border: 1px solid #eee;">Plafond</th>
                    <th style="padding: 12px; text-align: right; border: 1px solid #eee;">Montant (‚Ç¨)</th>
                </tr>
            </thead>
            <tbody>
                {% for contrib in contribution_details %}
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 12px; border: 1px solid #eee;"><strong>{{ contrib.name }}</strong></td>
                    <td style="padding: 12px; text-align: center; border: 1px solid #eee;">{{ contrib.rate|floatformat:2 }}%</td>
                    <td style="padding: 12px; text-align: center; border: 1px solid #eee;">{{ contrib.base|floatformat:2 }}</td>
                    <td style="padding: 12px; text-align: center; border: 1px solid #eee;">
                        {% if contrib.ceiling %}
                            {{ contrib.ceiling|floatformat:2 }}
                        {% else %}
                            ‚Äî
                        {% endif %}
                    </td>
                    <td style="padding: 12px; text-align: right; border: 1px solid #eee; font-weight: bold;">{{ contrib.amount|floatformat:2 }}</td>
                </tr>
                {% endfor %}
                <tr style="background: #f0f0f0; font-weight: bold; border-top: 2px solid #999;">
                    <td colspan="4" style="padding: 12px; text-align: right; border: 1px solid #eee;">TOTAL COTISATIONS</td>
                    <td style="padding: 12px; text-align: right; border: 1px solid #eee;">{{ total_contributions|floatformat:2 }} ‚Ç¨</td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 12px; margin-bottom: 20px; border-radius: 4px;">
        <p style="margin: 0; color: #856404;">
            <strong>‚ÑπÔ∏è Note:</strong> Ces cotisations sont calcul√©es selon les taux du code du travail fran√ßais 2026.
            Les montants avec plafond (ex: Agirc-Arrco) sont appliqu√©s uniquement sur la portion du salaire jusqu'au plafond fix√©.
        </p>
    </div>
    {% endif %}
    
    <!-- Net √† payer -->
    <div style="padding: 20px; background: #4caf50; color: white; border-radius: 6px; margin-bottom: 20px; text-align: center;">
        <p style="margin: 0; font-size: 0.9em;">Net √† Payer</p>
        <p style="margin: 10px 0 0 0; font-size: 2.5em; font-weight: bold;">{{ payroll.net_salary|floatformat:2 }} ‚Ç¨</p>
    </div>
    
    <!-- Actions -->
    <div style="display: flex; gap: 15px; margin-top: 30px;">
        <a href="/payroll/" class="btn btn-secondary" style="display: inline-block;">‚ùå Retour</a>
        <a href="{% url 'payroll_export' payroll.id %}" class="btn" style="display: inline-block;">üì• Exporter en PDF</a>
    </div>
</div>
{% endblock %}
