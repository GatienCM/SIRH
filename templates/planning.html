{% extends "base.html" %}

{% block header_actions %}
<a href="{% url 'shift_create' %}" class="btn">â• Ajouter</a>
{% endblock %}

{% block content %}
<div class="search-box">
    <form method="GET" style="display: flex; gap: 10px; width: 100%;">
        <input type="date" name="date" value="{{ filter_date }}">
        <button type="submit" class="btn">Filtrer</button>
    </form>
</div>

{% if shifts_data %}
<div class="table-container">
    <table>
        <thead>
            <tr>
                <th>ğŸ“… Date</th>
                <th>ğŸ• Heure DÃ©but</th>
                <th>ğŸ•‘ Heure Fin</th>
                <th>â±ï¸ Total heures</th>
                <th>ğŸ‘¥ EmployÃ©s & Statuts</th>
                <th>âš™ï¸ Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for item in shifts_data %}
            <tr {% if item.is_cancelled %}style="background-color: #f8d7da;"{% elif item.is_in_progress %}style="background-color: #fff3cd; font-weight: bold;"{% elif item.is_past %}style="background-color: #e8e8e8; opacity: 0.8;"{% endif %}>
                <td><strong>{{ item.shift.date|date:"d/m/Y" }}</strong></td>
                <td>{{ item.shift.start_time|time:"H:i" }}</td>
                <td>{{ item.shift.end_time|time:"H:i" }}</td>
                <td><strong>{{ item.shift.duration_hours|floatformat:2 }}h</strong></td>
                <td>
                    {% if item.is_cancelled %}
                        <div style="margin-bottom: 6px;">
                            <span class="badge" style="background-color: #dc3545;">ğŸš« Quart annulÃ©</span>
                        </div>
                    {% endif %}
                    {% for assignment in item.shift.assignments.all %}
                        <div style="margin-bottom: 5px;">
                            <strong>{{ assignment.employee.user.get_full_name }}</strong>
                            {% if assignment.status == 'cancelled' %}
                                <span class="badge" style="background-color: #868e96;">ğŸš« AnnulÃ©</span>
                            {% elif assignment.status == 'absent' %}
                                <span class="badge" style="background-color: #dc3545;">âŒ Absent</span>
                            {% elif item.is_cancelled %}
                                <span class="badge" style="background-color: #868e96;">ğŸš« AnnulÃ©</span>
                            {% elif assignment.status == 'completed' %}
                                <span class="badge" style="background-color: #6c757d;">âœ”ï¸ ComplÃ©tÃ©</span>
                            {% elif item.is_in_progress or assignment.status == 'in_progress' %}
                                <span class="badge" style="background-color: #ffc107;">â–¶ï¸ En cours</span>
                            {% elif item.is_past %}
                                <span class="badge" style="background-color: #28a745;">âœ”ï¸ COMPLÃ‰TÃ‰</span>
                            {% elif assignment.status == 'confirmed' %}
                                <span class="badge" style="background-color: #28a745;">âœ… ConfirmÃ©</span>
                            {% elif assignment.status == 'assigned' %}
                                <span class="badge" style="background-color: #007bff;">ğŸ“‹ AssignÃ©</span>
                            {% endif %}
                        </div>
                    {% endfor %}
                    {% if not item.shift.assignments.exists %}
                        <span class="badge badge-warning">âš ï¸ Aucun assignÃ©</span>
                    {% endif %}
                </td>
                <td>
                    <a href="{% url 'shift_edit' item.shift.id %}" class="btn" style="padding: 5px 10px; font-size: 0.85em;">âœï¸ Ã‰diter</a>
                    <a href="{% url 'shift_delete' item.shift.id %}" class="btn btn-secondary" style="padding: 5px 10px; font-size: 0.85em;" onclick="return confirm('Supprimer ce quart ?')">ğŸ—‘ï¸ Supprimer</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<p style="margin-top: 20px; color: #666; text-align: right;">
    <strong>Total :</strong> {{ shifts_data|length }} quart(s)
</p>
{% else %}
<div class="empty-state">
    <p>ğŸ˜• Aucun planning trouvÃ© pour cette pÃ©riode</p>
    <a href="{% url 'shift_create' %}" class="btn">â• CrÃ©er un quart</a>
</div>
{% endif %}
{% endblock %}
