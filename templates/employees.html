{% extends "base.html" %}

{% block header_actions %}
<form method="get" action="" style="display:inline; margin-right:10px;">
    <select id="view_employee_id" name="view_employee_id" style="padding:6px 10px; border-radius:6px; border:1px solid #ccc;">
        <option value="">ğŸ‘ï¸ Vue salariÃ©e...</option>
        {% for employee in employees %}
            <option value="{{ employee.id }}" {% if view_employee and view_employee.id == employee.id %}selected{% endif %}>{{ employee.user.get_full_name }}</option>
        {% endfor %}
    </select>
    <button type="button" class="btn" id="open_employee_view" style="margin-left:8px;">Ouvrir la vue</button>
</form>
<script>
document.getElementById('open_employee_view').onclick = function() {
    var id = document.getElementById('view_employee_id').value;
    if (id) {
        window.open('/employees/' + id + '/simulate/', '_blank');
    } else {
        alert('SÃ©lectionnez un salariÃ©.');
    }
};
</script>
<a href="{% url 'employee_create' %}" class="btn">â• Ajouter</a>
{% endblock %}

{% block content %}
<div class="search-box">
    <form method="GET" style="display: flex; gap: 10px; width: 100%;">
        <input type="text" name="search" placeholder="ğŸ” Rechercher un employÃ© (nom, email)..." value="{{ search }}">
        <button type="submit" class="btn">Chercher</button>
    </form>
</div>



{% if employees %}
<div class="table-container">
    <table>
        <thead>
            <tr>
                <th>ğŸ‘¤ Nom</th>
                <th>ğŸ“§ Email</th>
                <th>ğŸ’¼ Profession</th>
                <th>ğŸ“ Statut Contrat</th>
                <th>âš™ï¸ Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for employee in employees %}
            <tr>
                <td><strong>{{ employee.user.get_full_name }}</strong></td>
                <td>{{ employee.user.email }}</td>
                <td>{{ employee.profession.label|default:"Non assignÃ©" }}</td>
                <td>
                    {% if employee.status == 'active' %}
                        <span class="badge badge-success">âœ“ Actif</span>
                    {% elif employee.status == 'suspended' %}
                        <span class="badge badge-warning">â¸ Suspendu</span>
                    {% else %}
                        <span class="badge badge-danger">âœ— Sorti</span>
                    {% endif %}
                </td>
                <td>
                    <a href="{% url 'employee_edit' employee.id %}" class="btn" style="padding: 5px 10px; font-size: 0.85em;">âœï¸ Ã‰diter</a>
                    <a href="{% url 'employee_delete' employee.id %}" class="btn btn-secondary" style="padding: 5px 10px; font-size: 0.85em;" onclick="return confirm('ÃŠtes-vous sÃ»r de vouloir supprimer cet employÃ© ?')">ğŸ—‘ï¸ Supprimer</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<p style="margin-top: 20px; color: #666; text-align: right;">
    <strong>Total :</strong> {{ employees.count }} employÃ©(s)
</p>
{% else %}
<div class="empty-state">
    <p>ğŸ˜• Aucun employÃ© trouvÃ©</p>
    <a href="{% url 'employee_create' %}" class="btn">â• CrÃ©er un employÃ©</a>
</div>
{% endif %}
{% endblock %}

