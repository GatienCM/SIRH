{% extends "base.html" %}

{% block header_actions %}
<a href="{% url 'contract_create' %}" class="btn">â• Ajouter</a>
{% endblock %}

{% block content %}
<div class="search-box">
    <form method="GET" style="display: flex; gap: 10px; width: 100%;">
        <select name="status" style="padding: 10px 15px; border: 1px solid #ddd; border-radius: 6px;">
            <option value="">Tous les statuts</option>
            <option value="active" {% if status == 'active' %}selected{% endif %}>Actifs</option>
            <option value="inactive" {% if status == 'inactive' %}selected{% endif %}>Inactifs</option>
            <option value="expired" {% if status == 'expired' %}selected{% endif %}>ExpirÃ©s</option>
        </select>
        <button type="submit" class="btn">Filtrer</button>
    </form>
</div>

{% if contracts %}
<div class="table-container">
    <table>
        <thead>
            <tr>
                <th>ğŸ‘¤ EmployÃ©</th>
                <th>ğŸ“„ Type de Contrat</th>
                <th>ğŸ“… Date DÃ©but</th>
                <th>ğŸ“… Date Fin</th>
                <th>ğŸ’¼ Professionnel</th>
                <th>ğŸ“Š Statut</th>
                <th>ğŸ“„ Document</th>
                <th>âš™ï¸ Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for contract in contracts %}
            <tr>
                <td><strong>{{ contract.employee.user.get_full_name }}</strong></td>
                <td>{{ contract.get_contract_type_display }}</td>
                <td>{{ contract.start_date|date:"d/m/Y" }}</td>
                <td>{{ contract.end_date|date:"d/m/Y"|default:"CDI" }}</td>
                <td>{{ contract.employee.profession.label|default:"Non assignÃ©" }}</td>
                <td>
                    {% if contract.is_active %}
                        <span class="badge badge-success">âœ“ Actif</span>
                    {% elif contract.end_date < today %}
                        <span class="badge badge-danger">âœ— ExpirÃ©</span>
                    {% else %}
                        <span class="badge badge-warning">â³ Ã€ venir</span>
                    {% endif %}
                </td>
                <td>
                    {% if contract.contract_file %}
                        <a href="{% url 'contract_download' contract.id %}" class="btn" style="padding: 5px 10px; font-size: 0.85em; background: #28a745; color: white;" title="TÃ©lÃ©charger le contrat">
                            ğŸ“¥ Word
                        </a>
                        <a href="{% url 'contract_download' contract.id %}?regenerate=1" class="btn" style="padding: 5px 10px; font-size: 0.85em; background: #17a2b8; color: white;" title="RÃ©gÃ©nÃ©rer le contrat">
                            ğŸ”„
                        </a>
                    {% else %}
                        <a href="{% url 'contract_download' contract.id %}" class="btn" style="padding: 5px 10px; font-size: 0.85em; background: #ffc107; color: #333;" title="GÃ©nÃ©rer le contrat">
                            ğŸ“ GÃ©nÃ©rer
                        </a>
                    {% endif %}
                </td>
                <td>
                    <a href="{% url 'contract_edit' contract.id %}" class="btn" style="padding: 5px 10px; font-size: 0.85em;">âœï¸ Ã‰diter</a>
                    <a href="{% url 'contract_delete' contract.id %}" class="btn btn-secondary" style="padding: 5px 10px; font-size: 0.85em;" onclick="return confirm('Supprimer ce contrat ?')">ğŸ—‘ï¸ Supprimer</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<p style="margin-top: 20px; color: #666; text-align: right;">
    <strong>Total :</strong> {{ contracts.count }} contrat(s)
</p>
{% else %}
<div class="empty-state">
    <p>ğŸ˜• Aucun contrat trouvÃ©</p>
    <a href="{% url 'contract_create' %}" class="btn">â• CrÃ©er un contrat</a>
</div>
{% endif %}
{% endblock %}
